
(function($){$.fn.gallery=function(options){options=$.extend({duration:400,easing:'swing',rows:1,cols:5},options);return this.each(function(){var gallery=$(this),next=$('#'+gallery.attr('id')+'-next'),prev=$('#'+gallery.attr('id')+'-prev'),pos=$('#'+gallery.attr('id')+'-pos'),viewer=$('#'+gallery.attr('id')+'-viewer'),viewnext=$('#'+gallery.attr('id')+'-viewer-next'),viewprev=$('#'+gallery.attr('id')+'-viewer-prev'),thumbs=gallery.children(),pages=Math.ceil(thumbs.size()/(options.rows*options.cols)),tiles=options.rows*options.cols,newview,alignImage=function(view){var height=view.css('height'),width=view.css('width'),img=view.find('img'),imgheight=img.get(0).height,imgwidth=img.get(0).width,hpadding=(parseInt(height,10)-parseInt(imgheight,10))/2,vpadding=(parseInt(width,10)-parseInt(imgwidth,10))/2;if(hpadding>0&&imgheight>0){img.css('margin-top',hpadding);}
if(vpadding>0&&imgwidth>0){img.css('margin-left',vpadding);}},changePage=function(next){var currpage=parseInt(pos.text().slice(pos.text().indexOf(' ')+1,pos.text().indexOf(' of')),10),nextpage=next===true?currpage+1:currpage-1;if(nextpage<1){nextpage=pages;}else if(nextpage>pages){nextpage=1;}
var first=(nextpage-1)*tiles;gallery.fadeOut(options.duration,function(){thumbs.hide();pos.text('page '+nextpage+' of '+pages);if(nextpage===pages){thumbs.slice(first).show();}else{thumbs.slice(first,first+tiles).show();}
gallery.fadeIn(options.duration);});};gallery.css({'width':(thumbs.width()+parseInt(thumbs.css('margin-left'),10)+parseInt(thumbs.css('margin-right'),10)+parseInt(thumbs.css('padding-left'),10)+parseInt(thumbs.css('padding-right'),10))*options.cols,'height':(thumbs.height()+parseInt(thumbs.css('margin-bottom'),10)+parseInt(thumbs.css('margin-top'),10)+parseInt(thumbs.css('padding-bottom'),10)+parseInt(thumbs.css('padding-top'),10))*options.rows,'overflow':'hidden'});thumbs.css({'cursor':'pointer','display':'block'});thumbs.each(function(){$(this).bind('click',function(){var img=$(this).find('img').attr('src'),fullimg=img.substr(0,img.indexOf('thumbs'))+img.substr(img.lastIndexOf('/')+1);viewer.fadeOut(options.duration,function(){viewer.empty();viewer.append('<img src="'+fullimg+'" />');viewer.find('img').imagesLoaded(function(){viewer.fadeIn(options.duration);alignImage(viewer);});});}).imagesLoaded(function(){alignImage($(this));});});thumbs.hide(0).slice(0,tiles).fadeIn(options.duration);pos.text('page 1 of '+pages);prev.bind('click',function(){changePage(false);return false;});next.bind('click',function(){changePage(true);return false;});var initimg=thumbs.filter(':first').find('img').attr('src');initimg=initimg.substr(0,initimg.indexOf('/thumbs'))+initimg.substr(initimg.lastIndexOf('/'));viewer.hide().empty().append('<img src="'+initimg+'" />');viewer.find('img').imagesLoaded(function(){viewer.fadeIn(options.duration);alignImage(viewer);});viewnext.bind('click',function(){var viewerimg=viewer.find('img').attr('src'),nextimg=viewerimg.substr(0,viewerimg.lastIndexOf('/'))+'/thumbs'+viewerimg.substr(viewerimg.lastIndexOf('/')),index=0;thumbs.each(function(){var thumbimg=$(this).find('img').attr('src');if(thumbimg===nextimg){if(index+1>thumbs.length-1){nextimg=$(thumbs[0]).find('img').attr('src');}else{nextimg=$(thumbs[index+1]).find('img').attr('src');}
nextimg=nextimg.substr(0,nextimg.indexOf('thumbs'))+nextimg.substr(nextimg.lastIndexOf('/')+1);viewer.fadeOut(options.duration,function(){viewer.empty();viewer.append('<img src="'+nextimg+'" />');viewer.find('img').imagesLoaded(function(){viewer.fadeIn(options.duration);alignImage(viewer);});});return false;}
index++;});return false;});viewprev.bind('click',function(){var viewerimg=viewer.find('img').attr('src'),nextimg=viewerimg.substr(0,viewerimg.lastIndexOf('/'))+'/thumbs'+viewerimg.substr(viewerimg.lastIndexOf('/'));var index=0;thumbs.each(function(){var thumbimg=$(this).find('img').attr('src');if(thumbimg===nextimg){if(index===0){nextimg=$(thumbs[thumbs.length-1]).find('img').attr('src');}else{nextimg=$(thumbs[index-1]).find('img').attr('src');}
nextimg=nextimg.substr(0,nextimg.indexOf('thumbs'))+nextimg.substr(nextimg.lastIndexOf('/')+1);viewer.fadeOut(options.duration,function(){viewer.empty();viewer.append('<img src="'+nextimg+'" />');viewer.find('img').imagesLoaded(function(){viewer.fadeIn(options.duration);alignImage(viewer);});});return false;}
index++;});return false;});});};})(jQuery);